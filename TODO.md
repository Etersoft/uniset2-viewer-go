# TODO - UniSet2 Viewer

## UI улучшения

### Графики и шкала времени
- [x] Шкала времени: начало с момента добавления первого графика, ширина = выбранный интервал
- [x] При добавлении последующих датчиков шкала не меняется
- [x] Когда графики доезжают до конца - смещение на 90% (настраиваемый параметр)
- [x] Дополнительные временные интервалы: 1m, 3m, 3h

### Внешний вид
- [x] Техно-шрифт для заголовка "UniSet2 Viewer"
- [x] textname датчика в шапку графика
- [x] textname в таблицы входов/выходов
- [x] Подсветка состояния LogServer: RUNNING (зелёный), STOPPED (красный)

### Новые разделы (collapsible)
- [x] Раздел "Информация об объекте" (object) - внизу
- [x] Раздел "Статистика" (Statistics) с таблицей сенсоров (ID, имя, срабатывания) и фильтром
- [x] Раздел "Таймеры" (Timers) - рядом с входами/выходами (динамическая информация)
- [x] Раздел "LogServer" (если есть в ответе)

### Сохранение состояния
- [x] Сохранение состояния спойлеров в localStorage

### Архитектура рендереров
- [x] Расширяемая система рендереров по objectType
- [x] BaseObjectRenderer — базовый класс
- [x] UniSetManagerRenderer — полный функционал (IO, Timers, Variables, Statistics, LogServer)
- [x] UniSetObjectRenderer — упрощённый вид (без IO/Timers)
- [x] Badge с типом объекта на вкладке

## В работе

### UI исправления (текущая сессия)
- [x] Переименовать "Переменные" в "Настройки"
- [x] LogServer: исправить проверку RUNNING (опечатка RUNNIG в API)
- [x] Таймеры: добавить столбец tick
- [x] Входы/Выходы: добавить столбец textname
- [x] Графики: добавить textname в шапку панели графика
- [x] SSE: реализовать Server-Sent Events для realtime обновлений
  - [x] Backend: endpoint `/api/events` с SSE stream
  - [x] Backend: отправка событий при изменении данных объектов (через callback в poller)
  - [x] UI: подписка на SSE вместо polling
  - [x] UI: fallback на polling при отсутствии SSE (автоматическое переключение)
  - [x] Go unit-тесты для SSE (sse_test.go, poller_test.go)

### SSE улучшения
- [ ] Индикатор состояния SSE соединения в UI (connected/reconnecting/polling)
- [ ] Отображение времени polling в UI

### Тестирование
- [ ] Playwright e2e тесты на SSE функциональность
- [ ] Playwright тесты на fallback к polling при недоступности SSE
- [ ] Playwright тесты на рендереры объектов (UniSetManager, UniSetObject)

### Информация об объекте
- [ ] Первой строкой выводить: "Потеряно сообщений: xxx | Макс. размер очереди: yyy"
- [ ] Остальные параметры после этого

### Таймеры
- [ ] Оставшееся время (timeleft) должно постоянно обновляться
- [ ] Исправить отображение tick (сейчас не выводится)

### Типы объектов
- [ ] Fallback-рендерер: выводить сырой JSON и сообщение "тип объекта не поддерживается"
- [ ] Проработать отображение для других типов объектов
- [ ] Документировать API рендереров для расширения

## Данные от процесса

Структура ответа `/api/v01/{object}/`:
```json
{
  "TestProc": {
    "LogServer": { "host", "port", "state", "info": {...} },
    "Statistics": { "processingMessageCatchCount", "sensors": {...} },
    "Timers": { "1": { "id", "msec", "name", "tick", "timeleft" }, "count" },
    "Variables": { ... },
    "io": {
      "in": { ... },
      "out": { ... }
    },
    "myFloatVar": 42.42,
    "myMessage": "...",
    "myMode": "RUNNING",
    "myVar": 42
  },
  "object": {
    "id": 6000,
    "isActive": true,
    "lostMessages": 0,
    "maxSizeOfMessageQueue": 1000,
    "msgCount": 0,
    "name": "TestProc",
    "objectType": "UniSetManager"
  }
}
```

## Выполнено

- [x] Убрать заголовок таблицы легенды графика и вынести в шапку
- [x] Выбор цвета при клике на квадратик в легенде графика
- [x] Фильтрация переменных по имени с поддержкой ESC
- [x] Спойлеры (collapsible) для секций
- [x] Шкала времени на фиксированный интервал
- [x] Сворачиваемая боковая панель до значков
- [x] Дискретные графики без заливки по умолчанию
- [x] Чекбокс "фон" для включения/отключения заливки графика
- [x] Сохранение настроек интерфейса в localStorage (timeRange, sidebarCollapsed)
